{% extends "base.html" %}
{% block title %}Case Study · {{ trade.symbol }} · Banu Trading Portfolio{% endblock %}

{% block content %}

<div class="glass-card">
  <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:16px;flex-wrap:wrap;">
    <div>
      <div class="section-heading">
        {{ trade.symbol }} · {{ trade.timeframe or '' }} · {{ trade.trade_date }}
      </div>
      <p class="section-sub">
        Case study view of a single trade — including thesis, execution, and outcomes.
      </p>
      {% if trade.featured %}
        <span class="tag-strong" style="margin-top:8px;display:inline-flex;">
          Featured case study
        </span>
      {% endif %}
    </div>

    <a href="{{ url_for('public_root') }}" class="btn-outline" style="font-size:12px;">
      ← Back to portfolio
    </a>
  </div>
</div>

<div class="glass-card" style="margin-top:18px;display:grid;grid-template-columns:minmax(0,1.4fr) minmax(0,1fr);gap:24px;">
  <!-- LEFT: SUMMARY & METRICS -->
  <div style="display:flex;flex-direction:column;gap:16px;">
    <div>
      <div class="form-section-title">Summary</div>
      <p class="section-sub" style="margin-top:6px;line-height:1.5;">
        {{ trade.notes_public or "No public summary provided yet." }}
      </p>
    </div>

    <div>
      <div class="form-section-title">Core metrics</div>
      <div style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:14px;margin-top:10px;font-size:12px;">
        <div>
          <div class="section-sub">Result</div>
          <div style="margin-top:4px;">
            {% if trade.result == "WIN" %}
              <span class="badge badge-win">Win</span>
            {% elif trade.result == "LOSE" %}
              <span class="badge badge-lose">Lose</span>
            {% elif trade.result == "BE" %}
              <span class="badge badge-pending">BE</span>
            {% else %}
              <span class="badge">N/A</span>
            {% endif %}
          </div>
        </div>
        <div>
          <div class="section-sub">R multiple</div>
          <div style="font-size:16px;font-weight:600;margin-top:4px;">
            {{ trade.result_r if trade.result_r is not none else "-" }}
          </div>
        </div>
        <div>
          <div class="section-sub">Discipline score</div>
          <div style="font-size:16px;font-weight:600;margin-top:4px;">
            {{ trade.discipline_score if trade.discipline_score is not none else "-" }}{% if trade.discipline_score is not none %}%{% endif %}
          </div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:14px;margin-top:14px;font-size:12px;">
        <div>
          <div class="section-sub">Direction</div>
          <div style="margin-top:4px;">{{ trade.direction or "-" }}</div>
        </div>
        <div>
          <div class="section-sub">Entry / SL / TP</div>
          <div style="margin-top:4px;">
            {{ trade.entry_price or "-" }} /
            {{ trade.stop_loss or "-" }} /
            {{ trade.take_profit or "-" }}
          </div>
        </div>
        <div>
          <div class="section-sub">Risk per trade</div>
          <div style="margin-top:4px;">
            {{ trade.risk_percent if trade.risk_percent is not none else "-" }}{% if trade.risk_percent is not none %}%{% endif %}
          </div>
        </div>
      </div>
    </div>

    <div>
      <div class="form-section-title">Execution checklist</div>
      <div class="checklist-grid" style="margin-top:8px;">
        <div class="check-item">
          <span>Followed plan</span>
          <span style="margin-left:auto;">{{ "Yes" if trade.followed_plan else "No" }}</span>
        </div>
        <div class="check-item">
          <span>No revenge trade</span>
          <span style="margin-left:auto;">{{ "Yes" if trade.no_revenge else "No" }}</span>
        </div>
        <div class="check-item">
          <span>No FOMO entry</span>
          <span style="margin-left:auto;">{{ "Yes" if trade.no_fomo else "No" }}</span>
        </div>
        <div class="check-item">
          <span>Min R:R respected</span>
          <span style="margin-left:auto;">{{ "Yes" if trade.respected_rr else "No" }}</span>
        </div>
      </div>
    </div>

    {% if is_admin %}
    <div>
      <div class="form-section-title">Private notes (owner only)</div>
      <p class="section-sub" style="margin-top:6px;line-height:1.5;">
        {{ trade.notes_private or "No private notes written yet." }}
      </p>
    </div>
    {% endif %}
  </div>

  <!-- RIGHT: SCREENSHOTS -->
  <div style="display:flex;flex-direction:column;gap:16px;">
    <div>
      <div class="form-section-title">Screenshot BEFORE</div>
      {% if trade.screenshot_before %}
        <div style="margin-top:10px;border-radius:18px;overflow:hidden;border:1px solid rgba(148,163,184,0.35);background:#020617;">
          <img src="{{ url_for('uploaded_file', filename=trade.screenshot_before.split('/')[-1]) }}"
               alt="Before screenshot"
               style="display:block;width:100%;height:auto;">
        </div>
      {% else %}
        <p class="section-sub" style="margin-top:8px;">No screenshot uploaded.</p>
      {% endif %}
    </div>

    <div>
      <div class="form-section-title">Screenshot AFTER</div>
      {% if trade.screenshot_after %}
        <div style="margin-top:10px;border-radius:18px;overflow:hidden;border:1px solid rgba(148,163,184,0.35);background:#020617;">
          <img src="{{ url_for('uploaded_file', filename=trade.screenshot_after.split('/')[-1]) }}"
               alt="After screenshot"
               style="display:block;width:100%;height:auto;">
        </div>
      {% else %}
        <p class="section-sub" style="margin-top:8px;">No outcome screenshot uploaded.</p>
      {% endif %}
    </div>
  </div>
</div>

{% endblock %}
