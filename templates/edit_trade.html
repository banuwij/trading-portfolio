{% extends "base.html" %}
{% block title %}Edit Trade · Banu Trading Portfolio{% endblock %}

{% block content %}

<div class="glass-card">
  <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:16px;flex-wrap:wrap;">
    <div>
      <div class="section-heading">Edit Trade</div>
      <p class="section-sub">
        Update trade details, thesis notes, or screenshots. Changes will sync to both the owner
        dashboard and public case-study view.
      </p>
    </div>
    <a href="{{ url_for('admin_dashboard') }}" class="btn-outline" style="font-size:12px;">
      ← Back to dashboard
    </a>
  </div>
</div>

<div class="glass-card" style="margin-top:18px;">
  <form method="post" enctype="multipart/form-data" style="display:flex;flex-direction:column;gap:22px;">

    <!-- Core trade data -->
    <div>
      <div class="form-section-title">Core trade data</div>

      <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;margin-top:10px;">

        <div>
          <label class="form-label" for="trade_date">Trade Date</label>
          <input
            id="trade_date"
            name="trade_date"
            type="date"
            class="input-field"
            style="width:100%;margin-top:6px;"
            value="{{ trade.trade_date }}"
          >
        </div>

        <div>
          <label class="form-label" for="status">Status</label>
          <select id="status" name="status" class="input-field" style="width:100%;margin-top:6px;">
            <option value="PLANNED" {{ "selected" if trade.status == "PLANNED" else "" }}>Planned</option>
            <option value="ACTIVE"  {{ "selected" if trade.status == "ACTIVE"  else "" }}>Active</option>
            <option value="CLOSED"  {{ "selected" if trade.status == "CLOSED"  else "" }}>Closed</option>
          </select>
        </div>

        <div>
          <label class="form-label" for="symbol">Symbol / Pair</label>
          <input
            id="symbol"
            name="symbol"
            type="text"
            class="input-field"
            style="width:100%;margin-top:6px;"
            placeholder="e.g. BTCUSDT, ANTM"
            value="{{ trade.symbol }}"
          >
        </div>

        <div>
          <label class="form-label" for="timeframe">Timeframe</label>
          <input
            id="timeframe"
            name="timeframe"
            type="text"
            class="input-field"
            style="width:100%;margin-top:6px;"
            placeholder="e.g. H1, H4, D1"
            value="{{ trade.timeframe or '' }}"
          >
        </div>

        <div>
          <label class="form-label" for="direction">Direction</label>
          <select id="direction" name="direction" class="input-field" style="width:100%;margin-top:6px;">
            <option value="">-</option>
            <option value="BUY"  {{ "selected" if trade.direction == "BUY"  else "" }}>Buy</option>
            <option value="SELL" {{ "selected" if trade.direction == "SELL" else "" }}>Sell</option>
          </select>
        </div>

        <div>
          <label class="form-label" for="entry_price">Entry Price</label>
          <input
            id="entry_price"
            name="entry_price"
            type="number"
            step="0.01"
            class="input-field"
            style="width:100%;margin-top:6px;"
            placeholder="e.g. 91000.00"
            value="{{ trade.entry_price if trade.entry_price is not none else '' }}"
          >
        </div>

        <div>
          <label class="form-label" for="stop_loss">Stop Loss</label>
          <input
            id="stop_loss"
            name="stop_loss"
            type="number"
            step="0.01"
            class="input-field"
            style="width:100%;margin-top:6px;"
            placeholder="e.g. 89000.00"
            value="{{ trade.stop_loss if trade.stop_loss is not none else '' }}"
          >
        </div>

        <div>
          <label class="form-label" for="take_profit">Take Profit</label>
          <input
            id="take_profit"
            name="take_profit"
            type="number"
            step="0.01"
            class="input-field"
            style="width:100%;margin-top:6px;"
            placeholder="e.g. 110000.00"
            value="{{ trade.take_profit if trade.take_profit is not none else '' }}"
          >
        </div>

        <div>
          <label class="form-label" for="risk_percent">Risk per Trade (%)</label>
          <input
            id="risk_percent"
            name="risk_percent"
            type="number"
            step="0.1"
            class="input-field"
            style="width:100%;margin-top:6px;"
            placeholder="e.g. 0.5, 1, 2"
            value="{{ trade.risk_percent if trade.risk_percent is not none else '' }}"
          >
        </div>

        <div>
          <label class="form-label" for="result">Result</label>
          <select id="result" name="result" class="input-field" style="width:100%;margin-top:6px;">
            <option value=""        {{ "selected" if not trade.result else "" }}>Pending / N/A</option>
            <option value="WIN"     {{ "selected" if trade.result == "WIN"  else "" }}>Win</option>
            <option value="LOSE"    {{ "selected" if trade.result == "LOSE" else "" }}>Lose</option>
            <option value="BE"      {{ "selected" if trade.result == "BE"   else "" }}>Break-even</option>
          </select>
        </div>

        <div>
          <label class="form-label" for="grade">Grade</label>
          <input
            id="grade"
            name="grade"
            type="text"
            class="input-field"
            style="width:100%;margin-top:6px;"
            placeholder="e.g. A, B, C"
            value="{{ trade.grade or '' }}"
          >
        </div>

        <div>
          <label class="form-label" for="strategy_tag">Strategy / Setup</label>
          <input
            id="strategy_tag"
            name="strategy_tag"
            type="text"
            class="input-field"
            style="width:100%;margin-top:6px;"
            placeholder="e.g. SND, Trend, Breakout"
            value="{{ trade.strategy_tag or '' }}"
          >
        </div>

        <div>
          <label class="form-label" for="market_condition">Market Condition</label>
          <input
            id="market_condition"
            name="market_condition"
            type="text"
            class="input-field"
            style="width:100%;margin-top:6px;"
            placeholder="e.g. Trend, Range, News"
            value="{{ trade.market_condition or '' }}"
          >
        </div>

        <div style="grid-column:1 / -1;margin-top:4px;">
          <label class="form-label" style="display:flex;align-items:center;gap:8px;">
            <input
              type="checkbox"
              name="featured"
              value="1"
              {% if trade.featured %}checked{% endif %}
              style="width:14px;height:14px;"
            >
            <span>Mark as featured case study</span>
          </label>
        </div>

      </div>
    </div>

    <!-- Narrative & files -->
    <div>
      <div class="form-section-title">Narrative &amp; files</div>

      <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:14px;margin-top:10px;">
        <div>
          <label class="form-label" for="notes_public">Public summary (for HR)</label>
          <textarea
            id="notes_public"
            name="notes_public"
            rows="5"
            class="input-field"
            style="width:100%;margin-top:6px;resize:vertical;"
            placeholder="Thesis, execution, outcome, and key takeaways in a professional tone."
          >{{ trade.notes_public or "" }}</textarea>
        </div>

        <div>
          <label class="form-label" for="notes_private">Private notes (only you)</label>
          <textarea
            id="notes_private"
            name="notes_private"
            rows="5"
            class="input-field"
            style="width:100%;margin-top:6px;resize:vertical;"
            placeholder="Emotions, micro mistakes, alternative scenarios, deeper review."
          >{{ trade.notes_private or "" }}</textarea>
        </div>
      </div>
    </div>

    <!-- Screenshots -->
    <div>
      <div class="form-section-title">Screenshots</div>

      <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:14px;margin-top:10px;">

        <div>
          <label class="form-label" for="screenshot_before">Screenshot BEFORE (required for case study)</label>
          {% if trade.screenshot_before %}
            <p class="section-sub" style="margin-top:4px;margin-bottom:4px;font-size:11px;">
              Current file: {{ trade.screenshot_before }}
            </p>
          {% endif %}
          <input
            id="screenshot_before"
            name="screenshot_before"
            type="file"
            accept="image/*"
            class="input-field"
            style="width:100%;margin-top:6px;padding:7px 10px;"
          >
        </div>

        <div>
          <label class="form-label" for="screenshot_after">Screenshot AFTER (optional, for outcome)</label>
          {% if trade.screenshot_after %}
            <p class="section-sub" style="margin-top:4px;margin-bottom:4px;font-size:11px;">
              Current file: {{ trade.screenshot_after }}
            </p>
          {% endif %}
          <input
            id="screenshot_after"
            name="screenshot_after"
            type="file"
            accept="image/*"
            class="input-field"
            style="width:100%;margin-top:6px;padding:7px 10px;"
          >
        </div>

      </div>
    </div>

    <div style="margin-top:4px;">
      <button type="submit" class="btn-primary" style="width:100%;">
        Save changes
      </button>
    </div>

  </form>
</div>

{% endblock %}
