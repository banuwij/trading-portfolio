{% extends "base.html" %}
{% block title %}Edit Trade · Banu Trading Portfolio{% endblock %}

{% block content %}

<div class="glass-card">
  <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:16px;flex-wrap:wrap;">
    <div>
      <div class="section-heading">Edit Trade</div>
      <p class="section-sub">
        Update fields, notes, or screenshots for this case study.
      </p>
    </div>
    <a href="{{ url_for('trade_detail', trade_id=trade.id) }}" class="btn-outline" style="font-size:12px;">
      ← Back to detail
    </a>
  </div>
</div>

<div class="glass-card" style="margin-top:18px;">
  <form method="post" enctype="multipart/form-data" class="form-two-column">

    <div class="form-column">
      <div class="form-section-title">Core trade data</div>

      <div class="form-row-2">
        <label class="form-field">
          <span class="form-label">Trade Date</span>
          <input type="date" name="trade_date" value="{{ trade.trade_date }}">
        </label>

        <label class="form-field">
          <span class="form-label">Status</span>
          <select name="status">
            <option value="PLANNED" {{ 'selected' if trade.status=='PLANNED' }}>Planned</option>
            <option value="ACTIVE"  {{ 'selected' if trade.status=='ACTIVE'  }}>Active</option>
            <option value="CLOSED"  {{ 'selected' if trade.status=='CLOSED'  }}>Closed</option>
          </select>
        </label>
      </div>

      <div class="form-row-2">
        <label class="form-field">
          <span class="form-label">Symbol / Pair</span>
          <input type="text" name="symbol" value="{{ trade.symbol }}">
        </label>

        <label class="form-field">
          <span class="form-label">Timeframe</span>
          <input type="text" name="timeframe" value="{{ trade.timeframe }}">
        </label>
      </div>

      <div class="form-row-3">
        <label class="form-field">
          <span class="form-label">Direction</span>
          <select name="direction">
            <option value="">–</option>
            <option value="BUY"  {{ 'selected' if trade.direction=='BUY'  }}>Buy</option>
            <option value="SELL" {{ 'selected' if trade.direction=='SELL' }}>Sell</option>
          </select>
        </label>

        <label class="form-field">
          <span class="form-label">Entry Price</span>
          <input type="number" step="0.0001" name="entry_price" value="{{ trade.entry_price }}">
        </label>

        <label class="form-field">
          <span class="form-label">Stop Loss</span>
          <input type="number" step="0.0001" name="stop_loss" value="{{ trade.stop_loss }}">
        </label>
      </div>

      <div class="form-row-3">
        <label class="form-field">
          <span class="form-label">Take Profit</span>
          <input type="number" step="0.0001" name="take_profit" value="{{ trade.take_profit }}">
        </label>

        <label class="form-field">
          <span class="form-label">Risk per Trade (%)</span>
          <input type="number" step="0.01" name="risk_percent" value="{{ trade.risk_percent }}">
        </label>

        <label class="form-field">
          <span class="form-label">Result</span>
          <select name="result">
            <option value=""      {{ 'selected' if not trade.result }}>Pending / N/A</option>
            <option value="WIN"   {{ 'selected' if trade.result=='WIN'  }}>Win</option>
            <option value="LOSE"  {{ 'selected' if trade.result=='LOSE' }}>Lose</option>
            <option value="BE"    {{ 'selected' if trade.result=='BE'   }}>Break-Even</option>
          </select>
        </label>
      </div>

      <div class="form-row-3">
        <label class="form-field">
          <span class="form-label">Grade</span>
          <select name="grade">
            <option value=""  {{ 'selected' if not trade.grade }}>–</option>
            <option value="A" {{ 'selected' if trade.grade=='A' }}>A</option>
            <option value="B" {{ 'selected' if trade.grade=='B' }}>B</option>
            <option value="C" {{ 'selected' if trade.grade=='C' }}>C</option>
            <option value="D" {{ 'selected' if trade.grade=='D' }}>D</option>
          </select>
        </label>

        <label class="form-field">
          <span class="form-label">Strategy / Setup</span>
          <select name="strategy_tag">
            <option value=""      {{ 'selected' if not trade.strategy_tag }}>–</option>
            <option value="SND"   {{ 'selected' if trade.strategy_tag=='SND'   }}>SND</option>
            <option value="MR"    {{ 'selected' if trade.strategy_tag=='MR'    }}>MR</option>
            <option value="BO"    {{ 'selected' if trade.strategy_tag=='BO'    }}>BO</option>
            <option value="SWING" {{ 'selected' if trade.strategy_tag=='SWING' }}>SWING</option>
            <option value="INTRA" {{ 'selected' if trade.strategy_tag=='INTRA' }}>INTRA</option>
          </select>
        </label>

        <label class="form-field">
          <span class="form-label">Market Condition</span>
          <input type="text" name="market_condition" value="{{ trade.market_condition }}">
        </label>
      </div>

      <div class="form-section-title" style="margin-top:18px;">Execution checklist</div>
      <div class="checklist-grid">
        <label class="check-item">
          <input type="checkbox" name="followed_plan" {{ 'checked' if trade.followed_plan }}>
          <span>Followed plan</span>
        </label>
        <label class="check-item">
          <input type="checkbox" name="no_revenge" {{ 'checked' if trade.no_revenge }}>
          <span>No revenge trade</span>
        </label>
        <label class="check-item">
          <input type="checkbox" name="no_fomo" {{ 'checked' if trade.no_fomo }}>
          <span>No FOMO entry</span>
        </label>
        <label class="check-item">
          <input type="checkbox" name="respected_rr" {{ 'checked' if trade.respected_rr }}>
          <span>Min R:R respected</span>
        </label>
      </div>

      <label class="check-item" style="margin-top:8px;">
        <input type="checkbox" name="featured" {{ 'checked' if trade.featured }}>
        <span>Mark as featured case study</span>
      </label>
    </div>

    <div class="form-column">
      <div class="form-section-title">Narrative & files</div>

      <label class="form-field">
        <span class="form-label">Public summary (for HR)</span>
        <textarea name="notes_public" rows="6">{{ trade.notes_public }}</textarea>
      </label>

      <label class="form-field">
        <span class="form-label">Private notes (only you)</span>
        <textarea name="notes_private" rows="6">{{ trade.notes_private }}</textarea>
      </label>

      <div class="form-section-title" style="margin-top:12px;">Screenshots</div>

      {% if trade.screenshot_before_filename %}
        <p class="section-sub" style="font-size:12px;margin-bottom:6px;">
          Current BEFORE: {{ trade.screenshot_before_filename }}
        </p>
      {% endif %}
      <label class="form-field">
        <span class="form-label">Replace BEFORE screenshot (optional)</span>
        <input type="file" name="screenshot_before" accept="image/*">
      </label>

      {% if trade.screenshot_after_filename %}
        <p class="section-sub" style="font-size:12px;margin-bottom:6px;">
          Current AFTER: {{ trade.screenshot_after_filename }}
        </p>
      {% endif %}
      <label class="form-field">
        <span class="form-label">Replace AFTER screenshot (optional)</span>
        <input type="file" name="screenshot_after" accept="image/*">
      </label>

      <button type="submit" class="btn btn-primary" style="margin-top:18px;width:100%;">
        Save changes
      </button>
    </div>

  </form>
</div>

{% endblock %}
