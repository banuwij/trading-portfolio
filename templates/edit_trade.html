{% extends "base.html" %}
{% block title %}Edit Trade · Banu Trading Portfolio{% endblock %}

{% block content %}

<div class="glass-card">
  <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:16px;flex-wrap:wrap;">
    <div>
      <div class="section-heading">Edit Trade</div>
      <p class="section-sub">
        Update details, execution checklist, or upload updated screenshots.
        Changes here will sync to both the owner dashboard and public case-study view.
      </p>
    </div>
    <a href="{{ url_for('admin_dashboard') }}" class="btn-outline" style="font-size:12px;">
      ← Back to dashboard
    </a>
  </div>
</div>

<div class="glass-card" style="margin-top:18px;">
  <form method="post" enctype="multipart/form-data" class="form-two-column">

    <!-- LEFT COLUMN -->
    <div class="form-column">
      <div class="form-section-title">Core trade data</div>

      <div class="form-row-2">
        <label class="form-field">
          <span class="form-label">Trade Date</span>
          <input type="date" name="trade_date" value="{{ trade.trade_date }}" required>
        </label>

        <label class="form-field">
          <span class="form-label">Status</span>
          <select name="status" required>
            <option value="PLANNED" {% if trade.status == 'PLANNED' %}selected{% endif %}>Planned</option>
            <option value="ACTIVE" {% if trade.status == 'ACTIVE' %}selected{% endif %}>Active</option>
            <option value="CLOSED" {% if trade.status == 'CLOSED' %}selected{% endif %}>Closed</option>
          </select>
        </label>
      </div>

      <div class="form-row-2">
        <label class="form-field">
          <span class="form-label">Symbol / Pair</span>
          <input type="text" name="symbol" value="{{ trade.symbol }}" required>
        </label>

        <label class="form-field">
          <span class="form-label">Timeframe</span>
          <input type="text" name="timeframe" value="{{ trade.timeframe }}">
        </label>
      </div>

      <div class="form-row-3">
        <label class="form-field">
          <span class="form-label">Direction</span>
          <select name="direction" required>
            <option value="">–</option>
            <option value="BUY" {% if trade.direction == 'BUY' %}selected{% endif %}>Buy</option>
            <option value="SELL" {% if trade.direction == 'SELL' %}selected{% endif %}>Sell</option>
          </select>
        </label>

        <label class="form-field">
          <span class="form-label">Entry Price</span>
          <input type="number" step="0.0001" name="entry_price"
                 value="{{ trade.entry_price }}">
        </label>

        <label class="form-field">
          <span class="form-label">Stop Loss</span>
          <input type="number" step="0.0001" name="stop_loss"
                 value="{{ trade.stop_loss }}">
        </label>
      </div>

      <div class="form-row-3">
        <label class="form-field">
          <span class="form-label">Take Profit</span>
          <input type="number" step="0.0001" name="take_profit"
                 value="{{ trade.take_profit }}">
        </label>

        <label class="form-field">
          <span class="form-label">Risk per Trade (%)</span>
          <input type="number" step="0.01" name="risk_percent"
                 value="{{ trade.risk_percent }}">
        </label>

        <label class="form-field">
          <span class="form-label">Result</span>
          <select name="result">
            <option value="" {% if not trade.result %}selected{% endif %}>Pending / N/A</option>
            <option value="WIN" {% if trade.result == 'WIN' %}selected{% endif %}>Win</option>
            <option value="LOSE" {% if trade.result == 'LOSE' %}selected{% endif %}>Lose</option>
            <option value="BE" {% if trade.result == 'BE' %}selected{% endif %}>Break-Even</option>
          </select>
        </label>
      </div>

      <div class="form-row-3">
        <label class="form-field">
          <span class="form-label">Grade</span>
          <select name="grade">
            <option value="" {% if not trade.grade %}selected{% endif %}>–</option>
            <option value="A" {% if trade.grade == 'A' %}selected{% endif %}>A</option>
            <option value="B" {% if trade.grade == 'B' %}selected{% endif %}>B</option>
            <option value="C" {% if trade.grade == 'C' %}selected{% endif %}>C</option>
            <option value="D" {% if trade.grade == 'D' %}selected{% endif %}>D</option>
          </select>
        </label>

        <label class="form-field">
          <span class="form-label">Strategy / Setup</span>
          <select name="strategy_tag">
            <option value="" {% if not trade.strategy_tag %}selected{% endif %}>–</option>
            <option value="SND" {% if trade.strategy_tag == 'SND' %}selected{% endif %}>SND</option>
            <option value="MR" {% if trade.strategy_tag == 'MR' %}selected{% endif %}>MR</option>
            <option value="BO" {% if trade.strategy_tag == 'BO' %}selected{% endif %}>BO</option>
            <option value="SWING" {% if trade.strategy_tag == 'SWING' %}selected{% endif %}>SWING</option>
            <option value="INTRA" {% if trade.strategy_tag == 'INTRA' %}selected{% endif %}>INTRA</option>
          </select>
        </label>

        <label class="form-field">
          <span class="form-label">Market Condition</span>
          <input type="text" name="market_condition"
                 value="{{ trade.market_condition }}">
        </label>
      </div>

      <div class="form-section-title" style="margin-top:18px;">Execution checklist</div>
      <div class="checklist-grid">
        <label class="check-item">
          <input type="checkbox" name="followed_plan"
                 {% if trade.followed_plan %}checked{% endif %}>
          <span>Followed plan</span>
        </label>
        <label class="check-item">
          <input type="checkbox" name="no_revenge"
                 {% if trade.no_revenge %}checked{% endif %}>
          <span>No revenge trade</span>
        </label>
        <label class="check-item">
          <input type="checkbox" name="no_fomo"
                 {% if trade.no_fomo %}checked{% endif %}>
          <span>No FOMO entry</span>
        </label>
        <label class="check-item">
          <input type="checkbox" name="respected_rr"
                 {% if trade.respected_rr %}checked{% endif %}>
          <span>Min R:R respected</span>
        </label>
      </div>

      <label class="check-item" style="margin-top:8px;">
        <input type="checkbox" name="featured"
               {% if trade.featured %}checked{% endif %}>
        <span>Mark as featured case study</span>
      </label>
    </div>

    <!-- RIGHT COLUMN -->
    <div class="form-column">
      <div class="form-section-title">Narrative & files</div>

      <label class="form-field">
        <span class="form-label">Public summary (for HR)</span>
        <textarea name="notes_public" rows="6"
                  placeholder="Thesis, execution, outcome, and key takeaways in a professional tone.">{{ trade.notes_public }}</textarea>
      </label>

      <label class="form-field">
        <span class="form-label">Private notes (only you)</span>
        <textarea name="notes_private" rows="6"
                  placeholder="Emotions, micro mistakes, alternative scenarios, deeper review.">{{ trade.notes_private }}</textarea>
      </label>

      <div class="form-section-title" style="margin-top:12px;">Screenshots</div>

      <label class="form-field">
        <span class="form-label">Screenshot BEFORE</span>
        {% if trade.screenshot_before %}
          <div style="margin-bottom:6px;font-size:11px;color:var(--text-muted);">
            Current file:
            <a href="{{ url_for('uploaded_file', filename=trade.screenshot_before.split('/')[-1]) }}"
               target="_blank" style="color:#bae6fd;text-decoration:none;">
              open
            </a>
          </div>
        {% endif %}
        <input type="file" name="screenshot_before" accept="image/*">
      </label>

      <label class="form-field">
        <span class="form-label">Screenshot AFTER</span>
        {% if trade.screenshot_after %}
          <div style="margin-bottom:6px;font-size:11px;color:var(--text-muted);">
            Current file:
            <a href="{{ url_for('uploaded_file', filename=trade.screenshot_after.split('/')[-1]) }}"
               target="_blank" style="color:#bae6fd;text-decoration:none;">
              open
            </a>
          </div>
        {% endif %}
        <input type="file" name="screenshot_after" accept="image/*">
      </label>

      <button type="submit" class="btn-primary" style="margin-top:18px;width:100%;">
        Save changes
      </button>
    </div>

  </form>
</div>

{% endblock %}
