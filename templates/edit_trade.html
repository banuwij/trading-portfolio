{% extends "base.html" %}
{% block content %}
<h1 style="margin:0 0 6px;">Edit Trade</h1>
<p style="font-size:12px;color:#9ca3af;margin:0 0 10px;">
  Update the trade details including after-screenshot and review.
</p>

<div class="card">
  <form action="{{ url_for('edit_trade', trade_id=trade['id']) }}" method="post" enctype="multipart/form-data"
        style="display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px;">

    <div>
      <div style="margin-bottom:8px;">
        <label>Trade Date</label>
        <input type="date" name="trade_date" value="{{ trade['trade_date'] }}">
      </div>
      <div style="margin-bottom:8px;">
        <label>Symbol</label>
        <input name="symbol" value="{{ trade['symbol'] }}">
      </div>
      <div style="margin-bottom:8px;">
        <label>Timeframe</label>
        <input name="timeframe" value="{{ trade['timeframe'] }}">
      </div>
      <div style="margin-bottom:8px;">
        <label>Direction</label>
        <select name="direction">
          <option value="BUY" {% if trade['direction']=='BUY' %}selected{% endif %}>BUY</option>
          <option value="SELL" {% if trade['direction']=='SELL' %}selected{% endif %}>SELL</option>
        </select>
      </div>
      <div style="margin-bottom:8px;">
        <label>Entry Price</label>
        <input type="number" step="0.0001" name="entry_price" value="{{ trade['entry_price'] }}">
      </div>
      <div style="margin-bottom:8px;">
        <label>Stop Loss</label>
        <input type="number" step="0.0001" name="stop_loss" value="{{ trade['stop_loss'] }}">
      </div>
      <div style="margin-bottom:8px;">
        <label>Take Profit</label>
        <input type="number" step="0.0001" name="take_profit" value="{{ trade['take_profit'] }}">
      </div>
      <div style="margin-bottom:8px;">
        <label>Risk per Trade (% equity)</label>
        <input type="number" step="0.01" name="risk_percent"
               value="{{ trade['risk_percent'] if trade['risk_percent'] is not none else '' }}">
      </div>
      <div style="margin-bottom:8px;">
        <label>Result</label>
        <select name="result">
          <option value="" {% if not trade['result'] %}selected{% endif %}>Pending / N/A</option>
          <option value="WIN" {% if trade['result']=='WIN' %}selected{% endif %}>WIN</option>
          <option value="LOSE" {% if trade['result']=='LOSE' %}selected{% endif %}>LOSE</option>
        </select>
      </div>
      <div style="margin-bottom:8px;">
        <label>Grade</label>
        <select name="grade">
          <option value="">--</option>
          <option value="A" {% if trade['grade']=='A' %}selected{% endif %}>A</option>
          <option value="B" {% if trade['grade']=='B' %}selected{% endif %}>B</option>
          <option value="C" {% if trade['grade']=='C' %}selected{% endif %}>C</option>
          <option value="D" {% if trade['grade']=='D' %}selected{% endif %}>D</option>
        </select>
      </div>
      <div style="margin-bottom:8px;">
        <label>Strategy</label>
        {% set strategies=["Supply/Demand","Liquidity Sweep","Break & Retest","Trend Continuation","Range Reversion","News Catalyst","Fibo Reaction","Custom"] %}
        <select name="strategy_tag">
          <option value="">--</option>
          {% for s in strategies %}
            <option value="{{s}}" {% if trade['strategy_tag']==s %}selected{% endif %}>{{s}}</option>
          {% endfor %}
        </select>
      </div>
      <div style="margin-bottom:8px;">
        <label>Market Condition</label>
        {% set conditions=["Trending","Choppy","Range-bound","High Volatility","News/Event"] %}
        <select name="market_condition">
          <option value="">--</option>
          {% for c in conditions %}
            <option value="{{c}}" {% if trade['market_condition']==c %}selected{% endif %}>{{c}}</option>
          {% endfor %}
        </select>
      </div>
      <div style="margin-bottom:8px;">
        <label>Status</label>
        <select name="status">
          <option value="Planned" {% if trade['status']=='Planned' %}selected{% endif %}>Planned</option>
          <option value="Active" {% if trade['status']=='Active' %}selected{% endif %}>Active</option>
          <option value="Closed" {% if trade['status']=='Closed' %}selected{% endif %}>Closed</option>
        </select>
      </div>
      <div style="margin-bottom:8px;">
        <label>Execution Checklist</label>
        <label><input type="checkbox" name="followed_plan" {% if trade['followed_plan'] %}checked{% endif %}> Followed Plan</label>
        <label><input type="checkbox" name="no_revenge" {% if trade['no_revenge'] %}checked{% endif %}> No Revenge Trade</label>
        <label><input type="checkbox" name="no_fomo" {% if trade['no_fomo'] %}checked{% endif %}> No FOMO Entry</label>
        <label><input type="checkbox" name="respected_rr" {% if trade['respected_rr'] %}checked{% endif %}> Min R:R Respected</label>
      </div>
      <div style="margin-bottom:8px;">
        <label><input type="checkbox" name="featured" {% if trade['featured'] %}checked{% endif %}> Featured</label>
      </div>
      <div style="margin-bottom:8px;">
        <label>Upload BEFORE Screenshot (replace)</label>
        <input type="file" name="screenshot_before" accept="image/*">
      </div>
      <div style="margin-bottom:8px;">
        <label>Upload AFTER Screenshot (replace)</label>
        <input type="file" name="screenshot_after" accept="image/*">
      </div>
    </div>

    <div>
      <div style="margin-bottom:8px;">
        <label>Public Notes (HR)</label>
        <textarea name="notes_public" rows="7">{{ trade['notes_public'] }}</textarea>
      </div>
      <div style="margin-bottom:8px;">
        <label>Private Notes (You only)</label>
        <textarea name="notes_private" rows="7">{{ trade['notes_private'] }}</textarea>
      </div>
      <div style="margin-top:8px;">
        <button type="submit">Update Trade</button>
      </div>
    </div>

  </form>
</div>
{% endblock %}
