{% extends "base.html" %}
{% block title %}Trading Case Study Portfolio Â· Banu{% endblock %}

{% block content %}

<!-- ===== TradingView Ticker Tape ===== -->
<div class="glass-card" style="padding:10px 14px;margin-bottom:18px;">
  <div class="tradingview-widget-container">
    <div class="tradingview-widget-container__widget"></div>
    <div class="tradingview-widget-copyright" style="font-size:10px;text-align:right;">
      <a href="https://www.tradingview.com/markets/" rel="noopener nofollow" target="_blank">
        <span class="blue-text">Ticker tape</span>
      </a><span class="trademark"> by TradingView</span>
    </div>
    <script type="text/javascript"
            src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js"
            async>
    {
      "symbols": [
        {
          "proName": "FX_IDC:EURUSD",
          "title": "EURUSD"
        },
        {
          "proName": "BITSTAMP:BTCUSD",
          "title": "Bitcoin"
        },
        {
          "proName": "BITSTAMP:ETHUSD",
          "title": "Ethereum"
        },
        {
          "proName": "OANDA:XAUUSD",
          "title": "GOLD"
        },
        {
          "proName": "IDX:COMPOSITE",
          "title": "Indonesian Index"
        },
        {
          "proName": "IDX:BBCA",
          "title": "BBCA"
        }
      ],
      "colorTheme": "dark",
      "locale": "en",
      "largeChartUrl": "",
      "isTransparent": false,
      "showSymbolLogo": true,
      "displayMode": "adaptive"
    }
    </script>
  </div>
</div>
<!-- ===== End TradingView Ticker Tape ===== -->

<!-- HERO / SNAPSHOT -->
<div class="glass-card">
  <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:16px;flex-wrap:wrap;">
    <div>
      <div class="section-heading">Trading Case Study Portfolio</div>
      <p class="section-sub">
        This portfolio showcases how I approach markets: structured setups, disciplined risk, and post-trade reviews.
        Designed for hiring managers who want to see real decision-making, not only performance screenshots.
      </p>
    </div>

    <div style="min-width:220px;">
      <div class="section-sub">Snapshot</div>
      <div style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px;margin-top:8px;font-size:12px;">
        <div>
          <div class="section-sub">Closed trades</div>
          <div style="font-size:18px;font-weight:600;margin-top:2px;">{{ closed_count }}</div>
        </div>
        <div>
          <div class="section-sub">Win rate</div>
          <div style="font-size:18px;font-weight:600;margin-top:2px;">{{ win_rate }}%</div>
        </div>
        <div>
          <div class="section-sub">Average R:R</div>
          <div style="font-size:18px;font-weight:600;margin-top:2px;">{{ avg_r }}</div>
        </div>
      </div>
      <div class="section-sub" style="margin-top:8px;">Discipline score: {{ discipline_score }}%</div>
    </div>
  </div>
</div>

<!-- ALL TRADES TABLE -->
<div class="glass-card" style="margin-top:20px;">
  <div class="section-heading" style="font-size:16px;">All trades</div>
  <p class="section-sub">
    Planned, active, and closed case studies in a single view.
  </p>

  <table>
    <thead>
    <tr>
      <th>Date</th>
      <th>Symbol</th>
      <th>TF</th>
      <th>Dir</th>
      <th>Entry</th>
      <th>SL</th>
      <th>TP</th>
      <th>Status</th>
      <th>Result</th>
      <th>R</th>
      <th>Grade</th>
      <th></th>
    </tr>
    </thead>
    <tbody>
    {% set all_trades = planned + active + closed %}
    {% if all_trades %}
      {% for t in all_trades %}
      <tr>
        <td>{{ t.trade_date }}</td>
        <td>{{ t.symbol }}</td>
        <td>{{ t.timeframe or "-" }}</td>
        <td>
          {% if t.direction == "BUY" %}
            <span class="badge badge-dir-buy">Buy</span>
          {% elif t.direction == "SELL" %}
            <span class="badge badge-dir-sell">Sell</span>
          {% else %}
            <span class="badge">{{ t.direction or "-" }}</span>
          {% endif %}
        </td>
        <td>{{ t.entry_price|price }}</td>
        <td>{{ t.stop_loss|price }}</td>
        <td>{{ t.take_profit|price }}</td>
        <td>
          {% if t.status == "PLANNED" %}
            <span class="badge badge-status-planned">Planned</span>
          {% elif t.status == "ACTIVE" %}
            <span class="badge badge-status-active">Active</span>
          {% elif t.status == "CLOSED" %}
            <span class="badge badge-status-closed">Closed</span>
          {% else %}
            <span class="badge">{{ t.status or "-" }}</span>
          {% endif %}
        </td>
        <td>
          {% if t.result == "WIN" %}
            <span class="badge badge-win">Win</span>
          {% elif t.result == "LOSE" %}
            <span class="badge badge-lose">Lose</span>
          {% elif t.result == "BE" %}
            <span class="badge badge-pending">BE</span>
          {% else %}
            <span class="badge">N/A</span>
          {% endif %}
        </td>
        <td>{{ t.result_r if t.result_r is not none else "-" }}</td>
        <td>{{ t.grade or "-" }}</td>
        <td>
          <a href="{{ url_for('trade_detail', trade_id=t.id) }}"
             class="link-pill-outline"
             style="padding:3px 10px;font-size:10px;">
            View case
          </a>
        </td>
      </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td colspan="12" style="text-align:center;padding:14px 0;color:var(--text-muted);">
          No trades logged yet.
        </td>
      </tr>
    {% endif %}
    </tbody>
  </table>
</div>

<!-- ===== Market Overview + Economic Calendar Side by Side ===== -->
<div style="
  display:flex;
  gap:18px;
  margin-top:20px;
  flex-wrap:wrap;
">

  <!-- Market Overview -->
  <div class="glass-card" style="flex:1;min-width:350px;">
    <div class="section-heading" style="font-size:14px;">ðŸ“ˆ Market Overview</div>
    <div style="margin-top:10px;">
      <div class="tradingview-widget-container">
        <div class="tradingview-widget-container__widget"></div>
        <div class="tradingview-widget-copyright" style="font-size:10px;text-align:right;">
          <a href="https://www.tradingview.com/markets/" target="_blank" rel="noopener nofollow">
            <span class="blue-text">World markets</span>
          </a> by TradingView
        </div>
        <script type="text/javascript"
                src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
        {
          "colorTheme": "dark",
          "dateRange": "12M",
          "locale": "en",
          "largeChartUrl": "",
          "isTransparent": true,
          "showFloatingTooltip": false,
          "gridLineColor": "rgba(240, 243, 250, 0)",
          "scaleFontColor": "#DBDBDB",
          "belowLineFillColorGrowing": "rgba(41, 98, 255, 0.12)",
          "belowLineFillColorFalling": "rgba(41, 98, 255, 0.12)",
          "symbolActiveColor": "rgba(41, 98, 255, 0.12)",
          "tabs": [
            {
              "title": "Indices",
              "symbols": [
                {"s": "FOREXCOM:SPXUSD", "d": "S&P 500"},
                {"s": "FOREXCOM:NSXUSD", "d": "NASDAQ 100"},
                {"s": "FOREXCOM:DJI", "d": "Dow Jones"},
                {"s": "INDEX:NKY", "d": "Japan 225"},
                {"s": "INDEX:DEU40", "d": "DAX"},
                {"s": "FOREXCOM:UKXGBP", "d": "FTSE 100"}
              ]
            },
            {
              "title": "Forex",
              "symbols": [
                {"s": "FX:EURUSD", "d": "EUR/USD"},
                {"s": "FX:GBPUSD", "d": "GBP/USD"},
                {"s": "FX:USDJPY", "d": "USD/JPY"},
                {"s": "FX:USDCHF", "d": "USD/CHF"}
              ]
            }
          ],
          "width": "100%",
          "height": "480",
          "showSymbolLogo": true,
          "showChart": true,
          "backgroundColor": "#0f0f0f"
        }
        </script>
      </div>
    </div>
  </div>

  <!-- Economic Calendar -->
  <div class="glass-card" style="flex:1;min-width:350px;">
    <div class="section-heading" style="font-size:14px;">ðŸ“° Economic Calendar</div>

    <div style="margin-top:10px;height:480px;overflow:hidden;">
      <div class="tradingview-widget-container" style="height:100%;">
        <div class="tradingview-widget-container__widget" style="height:100%;"></div>
        <div class="tradingview-widget-copyright" style="font-size:10px;text-align:right;">
          <a href="https://www.tradingview.com/economic-calendar/"
             rel="noopener nofollow" target="_blank">
            <span class="blue-text">Economic Calendar</span>
          </a> by TradingView
        </div>
        <script type="text/javascript"
                src="https://s3.tradingview.com/external-embedding/embed-widget-events.js"
                async>
        {
          "colorTheme": "dark",
          "isTransparent": true,
          "locale": "en",
          "importanceFilter": "-1,0,1",
          "countryFilter": "us,gb,eu,jp,cn,id",
          "width": "100%",
          "height": "100%"
        }
        </script>
      </div>
    </div>

  </div>
</div>
<!-- ===== End Section ===== -->

{% endblock %}
